From e43a22236a728e1c128072f2706a81be5e95ecf0 Mon Sep 17 00:00:00 2001
From: Pison Jay <PisonJay@outlook.com>
Date: Tue, 10 Sep 2024 18:05:29 +0800
Subject: [PATCH] added call2

---
 drivers/platform/x86/asus-wmi.c | 40 +++++++++++++++++++++++++++++++++
 1 file changed, 40 insertions(+)

diff --git a/drivers/platform/x86/asus-wmi.c b/drivers/platform/x86/asus-wmi.c
index 37636e5a38e3..fd5baabfccd0 100644
--- a/drivers/platform/x86/asus-wmi.c
+++ b/drivers/platform/x86/asus-wmi.c
@@ -212,6 +212,7 @@ struct asus_wmi_debug {
 	u32 method_id;
 	u32 dev_id;
 	u32 ctrl_param;
+	u32 ctrl_param2;
 };
 
 struct asus_rfkill {
@@ -4608,10 +4609,46 @@ static int show_call(struct seq_file *m, void *data)
 	return 0;
 }
 
+static int show_call2(struct seq_file *m, void *data)
+{
+	struct asus_wmi *asus = m->private;
+	struct bios_args args = {
+		.arg0 = asus->debug.dev_id,
+		.arg1 = asus->debug.ctrl_param,
+		.arg2 = asus->debug.ctrl_param2
+	};
+	struct acpi_buffer input = { (acpi_size) sizeof(args), &args };
+	struct acpi_buffer output = { ACPI_ALLOCATE_BUFFER, NULL };
+	union acpi_object *obj;
+	acpi_status status;
+
+	status = wmi_evaluate_method(ASUS_WMI_MGMT_GUID,
+				     0, asus->debug.method_id,
+				     &input, &output);
+
+	if (ACPI_FAILURE(status))
+		return -EIO;
+
+	obj = (union acpi_object *)output.pointer;
+	if (obj && obj->type == ACPI_TYPE_INTEGER)
+		seq_printf(m, "%#x(%#x, %#x, %#x) = %#x\n", asus->debug.method_id,
+			   asus->debug.dev_id, asus->debug.ctrl_param, asus->debug.ctrl_param2,
+			   (u32) obj->integer.value);
+	else
+		seq_printf(m, "%#x(%#x, %#x, %#x) = t:%d\n", asus->debug.method_id,
+			   asus->debug.dev_id, asus->debug.ctrl_param, asus->debug.ctrl_param2,
+			   obj ? obj->type : -1);
+
+	kfree(obj);
+
+	return 0;
+}
+
 static struct asus_wmi_debugfs_node asus_wmi_debug_files[] = {
 	{NULL, "devs", show_devs},
 	{NULL, "dsts", show_dsts},
 	{NULL, "call", show_call},
+	{NULL, "call2", show_call2}
 };
 
 static int asus_wmi_debugfs_open(struct inode *inode, struct file *file)
@@ -4649,6 +4686,9 @@ static void asus_wmi_debugfs_init(struct asus_wmi *asus)
 	debugfs_create_x32("ctrl_param", S_IRUGO | S_IWUSR, asus->debug.root,
 			   &asus->debug.ctrl_param);
 
+	debugfs_create_x32("ctrl_param2", S_IRUGO | S_IWUSR, asus->debug.root,
+			   &asus->debug.ctrl_param2);
+
 	for (i = 0; i < ARRAY_SIZE(asus_wmi_debug_files); i++) {
 		struct asus_wmi_debugfs_node *node = &asus_wmi_debug_files[i];
 
-- 
2.46.0

